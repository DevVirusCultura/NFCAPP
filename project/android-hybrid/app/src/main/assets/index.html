<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFC Scanner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            padding: 20px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-top: 60px;
        }
        
        .title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.8;
            line-height: 1.5;
        }
        
        .scan-area {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .scan-circle {
            width: 200px;
            height: 200px;
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .scan-circle.scanning {
            animation: pulse 2s infinite;
            border-color: rgba(255, 255, 255, 0.8);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .scan-icon {
            font-size: 48px;
        }
        
        .status {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 20px;
            border-radius: 20px;
            margin-bottom: 20px;
        }
        
        .status-icon {
            margin-right: 8px;
        }
        
        .controls {
            margin-bottom: 40px;
        }
        
        .button {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .button-primary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .button-primary:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .button-primary:disabled {
            background: rgba(156, 163, 175, 0.3);
            border-color: rgba(156, 163, 175, 0.3);
            cursor: not-allowed;
        }
        
        .button-stop {
            background: rgba(239, 68, 68, 0.8);
            color: white;
        }
        
        .quick-actions {
            display: flex;
            gap: 8px;
        }
        
        .quick-action {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            text-decoration: none;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .quick-action:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .history {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .history-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .tag-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .tag-id {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .tag-time {
            font-size: 14px;
            opacity: 0.7;
        }
        
        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            text-align: center;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">NFC Scanner</h1>
            <p class="subtitle" id="subtitle">Hold an NFC tag near your device to scan</p>
        </div>
        
        <div class="scan-area">
            <div class="scan-circle" id="scanCircle">
                <div class="scan-icon">üì±</div>
            </div>
            
            <div class="status" id="status">
                <span class="status-icon">üì∂</span>
                <span id="statusText">NFC Ready</span>
            </div>
            
            <div class="error hidden" id="error"></div>
        </div>
        
        <div class="controls">
            <button class="button button-primary" id="scanButton" onclick="toggleScan()">
                Start Scan
            </button>
            
            <div class="quick-actions">
                <a href="#" class="quick-action" onclick="showHistory()">üìã History</a>
                <a href="#" class="quick-action" onclick="showEmulator()">‚ö° Emulator</a>
                <a href="#" class="quick-action" onclick="showSettings()">‚öôÔ∏è Settings</a>
            </div>
        </div>
        
        <div class="history" id="historySection">
            <h2 class="history-title">Recent Scans</h2>
            <div id="historyList">
                <p style="opacity: 0.7; text-align: center;">No tags scanned yet</p>
            </div>
        </div>
    </div>

    <script>
        // Stato globale dell'app
        let isScanning = false;
        let nfcSupported = false;
        let nfcEnabled = false;
        let tagHistory = [];
        
        // Inizializzazione quando il native backend √® pronto
        window.addEventListener('load', function() {
            checkNFCStatus();
            loadHistory();
        });
        
        // Callback dal backend nativo
        window.onNFCStatusChanged = function(status) {
            nfcSupported = status.supported;
            nfcEnabled = status.enabled;
            updateUI();
        };
        
        window.onTagScanned = function(tag) {
            console.log('Tag scanned:', tag);
            tagHistory.unshift(tag);
            updateHistory();
            showSuccess('Tag scanned successfully!');
            stopScanning();
        };
        
        window.onError = function(error) {
            showError(error);
            stopScanning();
        };
        
        window.onScannerStateChanged = function(state) {
            console.log('Scanner state:', state);
        };
        
        window.onHistoryUpdated = function(tags) {
            tagHistory = tags;
            updateHistory();
        };
        
        // Funzioni UI
        function toggleScan() {
            if (isScanning) {
                stopScan();
            } else {
                startScan();
            }
        }
        
        function startScan() {
            if (!nfcSupported) {
                showError('NFC not supported on this device');
                return;
            }
            
            if (!nfcEnabled) {
                showError('NFC is disabled. Please enable NFC in settings.');
                return;
            }
            
            isScanning = true;
            updateUI();
            
            // Chiama il backend nativo
            if (window.NFCBridge) {
                window.NFCBridge.startNFCScanning();
            }
        }
        
        function stopScan() {
            isScanning = false;
            updateUI();
            
            // Chiama il backend nativo
            if (window.NFCBridge) {
                window.NFCBridge.stopNFCScanning();
            }
        }
        
        function stopScanning() {
            isScanning = false;
            updateUI();
        }
        
        function updateUI() {
            const scanButton = document.getElementById('scanButton');
            const scanCircle = document.getElementById('scanCircle');
            const statusText = document.getElementById('statusText');
            const subtitle = document.getElementById('subtitle');
            
            if (isScanning) {
                scanButton.textContent = 'Stop Scanning';
                scanButton.className = 'button button-stop';
                scanCircle.classList.add('scanning');
                statusText.textContent = 'Scanning...';
                subtitle.textContent = 'Hold an NFC tag near your device';
            } else {
                scanButton.textContent = 'Start Scan';
                scanButton.className = 'button button-primary';
                scanCircle.classList.remove('scanning');
                
                if (!nfcSupported) {
                    statusText.textContent = 'NFC Not Supported';
                    scanButton.disabled = true;
                    subtitle.textContent = 'NFC not available on this device';
                } else if (!nfcEnabled) {
                    statusText.textContent = 'NFC Disabled';
                    scanButton.disabled = true;
                    subtitle.textContent = 'Please enable NFC in device settings';
                } else {
                    statusText.textContent = 'NFC Ready';
                    scanButton.disabled = false;
                    subtitle.textContent = 'Hold an NFC tag near your device to scan';
                }
            }
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }
        
        function showSuccess(message) {
            // Implementa notifica di successo
            console.log('Success:', message);
        }
        
        function checkNFCStatus() {
            if (window.NFCBridge) {
                nfcSupported = window.NFCBridge.isNFCSupported();
                nfcEnabled = window.NFCBridge.isNFCEnabled();
                updateUI();
            }
        }
        
        function loadHistory() {
            if (window.NFCBridge) {
                try {
                    const historyJson = window.NFCBridge.getTagHistory();
                    tagHistory = JSON.parse(historyJson);
                    updateHistory();
                } catch (e) {
                    console.error('Error loading history:', e);
                }
            }
        }
        
        function updateHistory() {
            const historyList = document.getElementById('historyList');
            
            if (tagHistory.length === 0) {
                historyList.innerHTML = '<p style="opacity: 0.7; text-align: center;">No tags scanned yet</p>';
                return;
            }
            
            const recentTags = tagHistory.slice(0, 3);
            historyList.innerHTML = recentTags.map(tag => `
                <div class="tag-card" onclick="showTagDetails('${tag.id}')">
                    <div class="tag-id">${tag.id}</div>
                    <div class="tag-time">${new Date(tag.timestamp).toLocaleString()}</div>
                </div>
            `).join('');
        }
        
        function showTagDetails(tagId) {
            // Implementa visualizzazione dettagli tag
            console.log('Show details for tag:', tagId);
        }
        
        function showHistory() {
            // Implementa schermata cronologia completa
            console.log('Show full history');
        }
        
        function showEmulator() {
            // Implementa schermata emulatore
            console.log('Show emulator');
        }
        
        function showSettings() {
            // Implementa schermata impostazioni
            console.log('Show settings');
        }
        
        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            updateUI();
        });
    </script>
</body>
</html>